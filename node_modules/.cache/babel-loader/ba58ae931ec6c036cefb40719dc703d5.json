{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar React = _interopRequireWildcard(require(\"react\"));\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n  return cache;\n}\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n  var cache = _getRequireWildcardCache();\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj[\"default\"] = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n  return _arr;\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n  return _assertThisInitialized(self);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nvar noop = function noop() {};\nvar _id = 0;\nvar generateId = function generateId() {\n  return \"simplemde-editor-\".concat(++_id);\n};\nvar SimpleMDEEditor = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(SimpleMDEEditor, _React$PureComponent);\n  var _super = _createSuper(SimpleMDEEditor);\n  function SimpleMDEEditor(props) {\n    var _this;\n    _classCallCheck(this, SimpleMDEEditor);\n    _this = _super.call(this, props);\n    _this.keyChange = false;\n    _this.state = {\n      value: _this.props.value || \"\"\n    };\n    _this.id = _this.props.id ? _this.props.id : generateId();\n    _this.simpleMde = null;\n    _this.editorEl = null;\n    _this.editorToolbarEl = null;\n    _this.imageUploadFunction = function (file, onSuccess, onError) {\n      var _this$props$options;\n      var imageUpload = (_this$props$options = _this.props.options) === null || _this$props$options === void 0 ? void 0 : _this$props$options.imageUploadFunction;\n      if (imageUpload) {\n        var _onSuccess = function _onSuccess(url) {\n          onSuccess(url); // update value when success\n\n          _this.eventWrapper();\n        };\n        imageUpload(file, _onSuccess, onError);\n      }\n    };\n    _this.createEditor = function () {\n      var _this$props$options2;\n      var SimpleMDE = require(\"easymde\");\n      var initialOptions = {\n        element: document.getElementById(_this.id),\n        initialValue: _this.props.value\n      };\n      var imageUploadFunction = ((_this$props$options2 = _this.props.options) === null || _this$props$options2 === void 0 ? void 0 : _this$props$options2.imageUploadFunction) ? _this.imageUploadFunction : undefined;\n      var allOptions = Object.assign({}, initialOptions, _this.props.options, {\n        imageUploadFunction: imageUploadFunction\n      });\n      _this.simpleMde = new SimpleMDE(allOptions);\n    };\n    _this.eventWrapper = function () {\n      _this.keyChange = true;\n      _this.setState({\n        value: _this.simpleMde.value()\n      });\n      _this.props.onChange(_this.simpleMde.value());\n    };\n    _this.removeEvents = function () {\n      if (_this.editorEl && _this.editorToolbarEl) {\n        _this.editorEl.removeEventListener(\"keyup\", _this.eventWrapper);\n        _this.editorEl.removeEventListener(\"paste\", _this.eventWrapper);\n        _this.editorToolbarEl.removeEventListener(\"click\", _this.eventWrapper);\n      }\n    };\n    _this.addEvents = function () {\n      if (_this.elementWrapperRef && _this.simpleMde) {\n        _this.editorEl = _this.elementWrapperRef;\n        _this.editorToolbarEl = _this.elementWrapperRef.getElementsByClassName(\"editor-toolbar\")[0];\n        _this.editorEl.addEventListener(\"keyup\", _this.eventWrapper);\n        _this.editorEl.addEventListener(\"paste\", _this.eventWrapper);\n        _this.editorToolbarEl && _this.editorToolbarEl.addEventListener(\"click\", _this.eventWrapper);\n        _this.simpleMde.codemirror.on(\"change\", _this.eventWrapper);\n        _this.simpleMde.codemirror.on(\"cursorActivity\", _this.getCursor);\n        var events = _this.props.events; // Handle custom events\n\n        events && Object.entries(events).forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            eventName = _ref2[0],\n            callback = _ref2[1];\n          if (eventName && callback) {\n            _this.simpleMde && _this.simpleMde.codemirror.on(eventName, callback);\n          }\n        });\n      }\n    };\n    _this.getCursor = function () {\n      // https://codemirror.net/doc/manual.html#api_selection\n      if (_this.props.getLineAndCursor) {\n        _this.props.getLineAndCursor(_this.simpleMde.codemirror.getDoc().getCursor());\n      }\n    };\n    _this.getMdeInstance = function () {\n      if (_this.props.getMdeInstance) {\n        _this.props.getMdeInstance(_this.simpleMde);\n      }\n    };\n    _this.addExtraKeys = function () {\n      // https://codemirror.net/doc/manual.html#option_extraKeys\n      if (_this.props.extraKeys) {\n        _this.simpleMde.codemirror.setOption(\"extraKeys\", Object.assign({}, _this.props.extraKeys, _this.simpleMde.codemirror.getOption(\"extraKeys\")));\n      }\n    };\n    _this.elementWrapperRef = null;\n    _this.setElementWrapperRef = function (element) {\n      _this.elementWrapperRef = element;\n    };\n    return _this;\n  }\n  _createClass(SimpleMDEEditor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (typeof window !== undefined) {\n        this.createEditor();\n        this.addEvents();\n        this.addExtraKeys();\n        this.getCursor();\n        this.getMdeInstance();\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (!this.keyChange && this.props.value !== this.state.value &&\n      // This is somehow fixes moving cursor for controlled case\n      this.props.value !== prevProps.value // This one fixes no value change for uncontrolled input. If it's uncontrolled prevProps will be the same\n      ) {\n        this.simpleMde.value(this.props.value || \"\");\n      }\n      this.keyChange = false;\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.editorEl !== null && this.editorEl !== undefined) {\n        this.removeEvents();\n      }\n    } // image upload function\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n        events = _this$props.events,\n        value = _this$props.value,\n        options = _this$props.options,\n        children = _this$props.children,\n        extraKeys = _this$props.extraKeys,\n        getLineAndCursor = _this$props.getLineAndCursor,\n        getMdeInstance = _this$props.getMdeInstance,\n        label = _this$props.label,\n        onChange = _this$props.onChange,\n        id = _this$props.id,\n        rest = _objectWithoutProperties(_this$props, [\"events\", \"value\", \"options\", \"children\", \"extraKeys\", \"getLineAndCursor\", \"getMdeInstance\", \"label\", \"onChange\", \"id\"]);\n      return /*#__PURE__*/React.createElement(\"div\", Object.assign({\n        id: \"\".concat(this.id, \"-wrapper\")\n      }, rest, {\n        ref: this.setElementWrapperRef\n      }), label && /*#__PURE__*/React.createElement(\"label\", {\n        htmlFor: this.id\n      }, \" \", label, \" \"), /*#__PURE__*/React.createElement(\"textarea\", {\n        id: this.id\n      }));\n    }\n  }]);\n  return SimpleMDEEditor;\n}(React.PureComponent);\nexports[\"default\"] = SimpleMDEEditor;\nSimpleMDEEditor.defaultProps = {\n  events: {},\n  onChange: noop,\n  options: {}\n};","map":{"version":3,"sources":["../src/index.tsx"],"names":["noop","_id","generateId","SimpleMDEEditor","React","PureComponent","keyChange","defaultProps","events","onChange","options","state","value","props","id","simpleMde","editorEl","editorToolbarEl","elementWrapperRef","setElementWrapperRef","element","window","undefined","createEditor","addEvents","addExtraKeys","getCursor","getMdeInstance","prevProps","removeEvents","imageUploadFunction","file","onSuccess","onError","imageUpload","_onSuccess","url","eventWrapper","SimpleMDE","require","initialOptions","document","getElementById","initialValue","allOptions","assign","setState","removeEventListener","getElementsByClassName","addEventListener","codemirror","on","entries","forEach","eventName","callback","getLineAndCursor","getDoc","extraKeys","setOption","Object","getOption","children","label","rest"],"mappings":";;;;;;AAAA,IAAA,KAAA,GAAA,uBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAMA,IAAI,GAAG,SAAPA,IAAO,GAAM,CAAE,CAArB;AACA,IAAIC,GAAG,GAAG,CAAV;AAEA,IAAMC,UAAU,GAAG,SAAbA,UAAa,GAAA;EAAA,OAAA,mBAAA,CAAA,MAAA,CAA0B,EAAED,GAA5B,CAAA;AAAA,CAAnB;IAqCqBE,e;;;EAuBnB,SAAA,eAAA,CAAYU,KAAZ,EAAyC;IAAA,IAAA,KAAA;IAAA,eAAA,CAAA,IAAA,EAAA,eAAA,CAAA;IACvC,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,KAAN,CAAA;IADuC,KAAA,CAjBjCP,SAiBiC,GAjBrB,KAiBqB;IAAA,KAAA,CATzCK,KASyC,GATjC;MACNC,KAAK,EAAE,KAAA,CAAKC,KAAL,CAAWD,KAAX,IAAoB;IADrB,CASiC;IAAA,KAAA,CALzCE,EAKyC,GALpC,KAAA,CAAKD,KAAL,CAAWC,EAAX,GAAgB,KAAA,CAAKD,KAAL,CAAWC,EAA3B,GAAgCZ,UAAU,EAKN;IAAA,KAAA,CAJzCa,SAIyC,GAJX,IAIW;IAAA,KAAA,CAHzCC,QAGyC,GAHP,IAGO;IAAA,KAAA,CAFzCC,eAEyC,GAFP,IAEO;IAAA,KAAA,CAoCzCa,mBApCyC,GAoCnB,UAACC,IAAD,EAAaC,SAAb,EAA+CC,OAA/C,EAAoF;MAAA,IAAA,mBAAA;MACxG,IAAMC,WAAW,GAAA,CAAA,mBAAA,GAAG,KAAA,CAAKrB,KAAL,CAAWH,OAAd,MAAA,IAAA,IAAA,mBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAG,mBAAA,CAAoBoB,mBAAxC;MACA,IAAII,WAAJ,EAAiB;QACb,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACC,GAAD,EAAiB;UAChCJ,SAAS,CAACI,GAAD,CAATJ,CADgC,CAEhC;;UACA,KAAA,CAAKK,YAAL,EAAA;QACH,CAJD;QAKAH,WAAW,CAACH,IAAD,EAAOI,UAAP,EAAmBF,OAAnB,CAAXC;MACH;IACJ,CA9C0C;IAAA,KAAA,CAgDzCX,YAhDyC,GAgD1B,YAAM;MAAA,IAAA,oBAAA;MACnB,IAAMe,SAAS,GAAGC,OAAO,CAAC,SAAD,CAAzB;MACA,IAAMC,cAAc,GAAG;QACrBpB,OAAO,EAAEqB,QAAQ,CAACC,cAATD,CAAwB,KAAA,CAAK3B,EAA7B2B,CADY;QAErBE,YAAY,EAAE,KAAA,CAAK9B,KAAL,CAAWD;MAFJ,CAAvB;MAKA,IAAMkB,mBAAmB,GAAG,CAAA,CAAA,oBAAA,GAAA,KAAA,CAAKjB,KAAL,CAAWH,OAAX,MAAA,IAAA,IAAA,oBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,oBAAA,CAAoBoB,mBAApB,IAA0C,KAAA,CAAKA,mBAA/C,GAAqER,SAAjG;MACA,IAAMsB,UAAU,GAAG,MAAM,CAACC,MAAP,CAAc,CAAA,CAAd,EAAkBL,cAAlB,EAAkC,KAAA,CAAK3B,KAAL,CAAWH,OAA7C,EAAsD;QAAEoB,mBAAmB,EAAnBA;MAAF,CAAtD,CAAnB;MACA,KAAA,CAAKf,SAAL,GAAiB,IAAIuB,SAAJ,CAAcM,UAAd,CAAjB;IACD,CA1DwC;IAAA,KAAA,CA4DzCP,YA5DyC,GA4D1B,YAAM;MACnB,KAAA,CAAK/B,SAAL,GAAiB,IAAjB;MACA,KAAA,CAAKwC,QAAL,CAAc;QACZlC,KAAK,EAAE,KAAA,CAAKG,SAAL,CAAgBH,KAAhB;MADK,CAAd,CAAA;MAGA,KAAA,CAAKC,KAAL,CAAWJ,QAAX,CAAoB,KAAA,CAAKM,SAAL,CAAgBH,KAAhB,EAApB,CAAA;IACD,CAlEwC;IAAA,KAAA,CAoEzCiB,YApEyC,GAoE1B,YAAM;MACnB,IAAI,KAAA,CAAKb,QAAL,IAAiB,KAAA,CAAKC,eAA1B,EAA2C;QACzC,KAAA,CAAKD,QAAL,CAAc+B,mBAAd,CAAkC,OAAlC,EAA2C,KAAA,CAAKV,YAAhD,CAAA;QACA,KAAA,CAAKrB,QAAL,CAAc+B,mBAAd,CAAkC,OAAlC,EAA2C,KAAA,CAAKV,YAAhD,CAAA;QACA,KAAA,CAAKpB,eAAL,CAAqB8B,mBAArB,CAAyC,OAAzC,EAAkD,KAAA,CAAKV,YAAvD,CAAA;MACD;IACF,CA1EwC;IAAA,KAAA,CA4EzCb,SA5EyC,GA4E7B,YAAM;MAChB,IAAI,KAAA,CAAKN,iBAAL,IAA0B,KAAA,CAAKH,SAAnC,EAA8C;QAC5C,KAAA,CAAKC,QAAL,GAAgB,KAAA,CAAKE,iBAArB;QACA,KAAA,CAAKD,eAAL,GAAuB,KAAA,CAAKC,iBAAL,CAAuB8B,sBAAvB,CACrB,gBADqB,CAAA,CAErB,CAFqB,CAAvB;QAIA,KAAA,CAAKhC,QAAL,CAAciC,gBAAd,CAA+B,OAA/B,EAAwC,KAAA,CAAKZ,YAA7C,CAAA;QACA,KAAA,CAAKrB,QAAL,CAAciC,gBAAd,CAA+B,OAA/B,EAAwC,KAAA,CAAKZ,YAA7C,CAAA;QACA,KAAA,CAAKpB,eAAL,IACE,KAAA,CAAKA,eAAL,CAAqBgC,gBAArB,CAAsC,OAAtC,EAA+C,KAAA,CAAKZ,YAApD,CADF;QAGA,KAAA,CAAKtB,SAAL,CAAemC,UAAf,CAA0BC,EAA1B,CAA6B,QAA7B,EAAuC,KAAA,CAAKd,YAA5C,CAAA;QACA,KAAA,CAAKtB,SAAL,CAAemC,UAAf,CAA0BC,EAA1B,CAA6B,gBAA7B,EAA+C,KAAA,CAAKzB,SAApD,CAAA;QAZ4C,IAcpClB,MAdoC,GAczB,KAAA,CAAKK,KAdoB,CAcpCL,MAdoC,CAAA,CAgB5C;;QACAA,MAAM,IACJ,MAAM,CAAC4C,OAAP,CAAe5C,MAAf,CAAA,CAAuB6C,OAAvB,CAA+B,UAAA,IAAA,EAA2B;UAAA,IAAA,KAAA,GAAA,cAAA,CAAA,IAAA,EAAA,CAAA,CAAA;YAAzBC,SAAyB,GAAA,KAAA,CAAA,CAAA,CAAA;YAAdC,QAAc,GAAA,KAAA,CAAA,CAAA,CAAA;UACxD,IAAID,SAAS,IAAIC,QAAjB,EAA2B;YACzB,KAAA,CAAKxC,SAAL,IACE,KAAA,CAAKA,SAAL,CAAemC,UAAf,CAA0BC,EAA1B,CACEG,SADF,EAEEC,QAFF,CADF;UAKD;QACF,CARD,CADF/C;MAUD;IACF,CAzGwC;IAAA,KAAA,CA2GzCkB,SA3GyC,GA2G7B,YAAM;MAChB;MACA,IAAI,KAAA,CAAKb,KAAL,CAAW2C,gBAAf,EAAiC;QAC/B,KAAA,CAAK3C,KAAL,CAAW2C,gBAAX,CACE,KAAA,CAAKzC,SAAL,CAAgBmC,UAAhB,CAA2BO,MAA3B,EAAA,CAAoC/B,SAApC,EADF,CAAA;MAGD;IACF,CAlHwC;IAAA,KAAA,CAoHzCC,cApHyC,GAoHxB,YAAM;MACrB,IAAI,KAAA,CAAKd,KAAL,CAAWc,cAAf,EAA+B;QAC7B,KAAA,CAAKd,KAAL,CAAWc,cAAX,CAA0B,KAAA,CAAKZ,SAA/B,CAAA;MACD;IACF,CAxHwC;IAAA,KAAA,CA0HzCU,YA1HyC,GA0H1B,YAAM;MACnB;MACA,IAAI,KAAA,CAAKZ,KAAL,CAAW6C,SAAf,EAA0B;QACxB,KAAA,CAAK3C,SAAL,CAAgBmC,UAAhB,CAA2BS,SAA3B,CAAqC,WAArC,EAAkDC,MAAM,CAACf,MAAPe,CAChD,CAAA,CADgDA,EAEhD,KAAA,CAAK/C,KAAL,CAAW6C,SAFqCE,EAGhD,KAAA,CAAK7C,SAAL,CAAgBmC,UAAhB,CAA2BW,SAA3B,CAAqC,WAArC,CAHgDD,CAAlD,CAAA;MAKD;IACF,CAnIwC;IAEvC,KAAA,CAAK1C,iBAAL,GAAyB,IAAzB;IACA,KAAA,CAAKC,oBAAL,GAA4B,UAACC,OAAD,EAA6B;MACvD,KAAA,CAAKF,iBAAL,GAAyBE,OAAzB;IACD,CAFD;IAHuC,OAAA,KAAA;EAMxC;;;wCAEmB;MAClB,IAAI,OAAOC,MAAP,KAAkBC,SAAtB,EAAiC;QAC/B,IAAA,CAAKC,YAAL,EAAA;QACA,IAAA,CAAKC,SAAL,EAAA;QACA,IAAA,CAAKC,YAAL,EAAA;QACA,IAAA,CAAKC,SAAL,EAAA;QACA,IAAA,CAAKC,cAAL,EAAA;MACD;IACF;;;uCAEkBC,S,EAAiC;MAClD,IACE,CAAC,IAAA,CAAKtB,SAAN,IACA,IAAA,CAAKO,KAAL,CAAWD,KAAX,KAAqB,IAAA,CAAKD,KAAL,CAAWC,KADhC;MACyC;MACzC,IAAA,CAAKC,KAAL,CAAWD,KAAX,KAAqBgB,SAAS,CAAChB,KAHjC,CAGuC;MAAA,EACrC;QACA,IAAA,CAAKG,SAAL,CAAgBH,KAAhB,CAAsB,IAAA,CAAKC,KAAL,CAAWD,KAAX,IAAoB,EAA1C,CAAA;MACD;MACD,IAAA,CAAKN,SAAL,GAAiB,KAAjB;IACD;;;2CAEsB;MACrB,IAAI,IAAA,CAAKU,QAAL,KAAkB,IAAlB,IAA0B,IAAA,CAAKA,QAAL,KAAkBM,SAAhD,EAA2D;QACzD,IAAA,CAAKO,YAAL,EAAA;MACD;IACF,C,CAED;;;6BAkGS;MAAA,IAAA,WAAA,GAaH,IAAA,CAAKhB,KAbF;QAELL,MAFK,GAAA,WAAA,CAELA,MAFK;QAGLI,KAHK,GAAA,WAAA,CAGLA,KAHK;QAILF,OAJK,GAAA,WAAA,CAILA,OAJK;QAKLoD,QALK,GAAA,WAAA,CAKLA,QALK;QAMLJ,SANK,GAAA,WAAA,CAMLA,SANK;QAOLF,gBAPK,GAAA,WAAA,CAOLA,gBAPK;QAQL7B,cARK,GAAA,WAAA,CAQLA,cARK;QASLoC,KATK,GAAA,WAAA,CASLA,KATK;QAULtD,QAVK,GAAA,WAAA,CAULA,QAVK;QAWLK,EAXK,GAAA,WAAA,CAWLA,EAXK;QAYFkD,IAZE,GAAA,wBAAA,CAAA,WAAA,EAAA,CAAA,QAAA,EAAA,OAAA,EAAA,SAAA,EAAA,UAAA,EAAA,WAAA,EAAA,kBAAA,EAAA,gBAAA,EAAA,OAAA,EAAA,UAAA,EAAA,IAAA,CAAA,CAAA;MAcP,OAAA,aACE,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA,MAAA,CAAA,MAAA,CAAA;QAAK,EAAE,EAAA,EAAA,CAAA,MAAA,CAAK,IAAA,CAAKlD,EAAV,EAAA,UAAA;MAAP,CAAA,EAAmCkD,IAAnC,EAAA;QAAyC,GAAG,EAAE,IAAA,CAAK7C;MAAnD,CAAA,CAAA,EACG4C,KAAK,IAAA,aAAI,KAAA,CAAA,aAAA,CAAA,OAAA,EAAA;QAAO,OAAO,EAAE,IAAA,CAAKjD;MAArB,CAAA,EAAA,GAAA,EAA2BiD,KAA3B,EAAA,GAAA,CADZ,EAAA,aAEE,KAAA,CAAA,aAAA,CAAA,UAAA,EAAA;QAAU,EAAE,EAAE,IAAA,CAAKjD;MAAnB,CAAA,CAFF,CADF;IAMD;;;EAhL0CV,KAAK,CAACC,a;;AAA9BF,e,CAQZI,Y,GAAe;EACpBC,MAAM,EAAE,CAAA,CADY;EAEpBC,QAAQ,EAAET,IAFU;EAGpBU,OAAO,EAAE,CAAA;AAHW,C","sourcesContent":["import * as React from \"react\";\nimport * as SimpleMDE from \"easymde\";\nimport { KeyMap, DOMEvent, Editor } from \"codemirror\";\n\nconst noop = () => {};\nlet _id = 0;\n\nconst generateId = () => `simplemde-editor-${++_id}`;\n\ntype CodemirrorEvents =\n  | \"change\"\n  | \"changes\"\n  | \"beforeChange\"\n  | \"cursorActivity\"\n  | \"beforeSelectionChange\"\n  | \"viewportChange\"\n  | \"gutterClick\"\n  | \"focus\"\n  | \"blur\"\n  | \"scroll\"\n  | \"update\"\n  | \"renderLine\";\n\ntype SimpleMdeToCodemirror = {\n  [E in CodemirrorEvents | DOMEvent]?: Editor[\"on\"]\n};\n\nexport interface SimpleMDEEditorProps {\n  id?: string;\n  label?: string;\n  onChange: (value: string) => void | any;\n  value?: string;\n  className?: string;\n  extraKeys?: KeyMap;\n  options?: SimpleMDE.Options;\n  events?: SimpleMdeToCodemirror;\n  getMdeInstance?: (instance: SimpleMDE) => void | any;\n  getLineAndCursor?: (position: CodeMirror.Position) => void | any;\n}\n\ntype SimpleMDEEditorState = {\n  value: string;\n};\n\nexport default class SimpleMDEEditor extends React.PureComponent<\n  SimpleMDEEditorProps,\n  SimpleMDEEditorState\n> {\n  private elementWrapperRef: HTMLDivElement | null;\n  private setElementWrapperRef: (element: HTMLDivElement) => void;\n  private keyChange = false;\n\n  static defaultProps = {\n    events: {},\n    onChange: noop,\n    options: {}\n  };\n\n  state = {\n    value: this.props.value || \"\"\n  };\n\n  id = this.props.id ? this.props.id : generateId();\n  simpleMde: SimpleMDE | null = null;\n  editorEl: HTMLDivElement | null = null;\n  editorToolbarEl: Element | null = null;\n\n  constructor(props: SimpleMDEEditorProps) {\n    super(props);\n    this.elementWrapperRef = null;\n    this.setElementWrapperRef = (element: HTMLDivElement) => {\n      this.elementWrapperRef = element;\n    };\n  }\n\n  componentDidMount() {\n    if (typeof window !== undefined) {\n      this.createEditor();\n      this.addEvents();\n      this.addExtraKeys();\n      this.getCursor();\n      this.getMdeInstance();\n    }\n  }\n\n  componentDidUpdate(prevProps: SimpleMDEEditorProps) {\n    if (\n      !this.keyChange &&\n      this.props.value !== this.state.value && // This is somehow fixes moving cursor for controlled case\n      this.props.value !== prevProps.value // This one fixes no value change for uncontrolled input. If it's uncontrolled prevProps will be the same\n    ) {\n      this.simpleMde!.value(this.props.value || \"\");\n    }\n    this.keyChange = false;\n  }\n\n  componentWillUnmount() {\n    if (this.editorEl !== null && this.editorEl !== undefined) {\n      this.removeEvents();\n    }\n  }\n\n  // image upload function\n  imageUploadFunction = (file: File, onSuccess: (url: string) => void, onError: (error: string) => void) => {\n    const imageUpload = this.props.options?.imageUploadFunction\n    if (imageUpload) {\n        const _onSuccess = (url: string) => {\n            onSuccess(url)\n            // update value when success\n            this.eventWrapper()\n        }\n        imageUpload(file, _onSuccess, onError)\n    }\n}\n\n  createEditor = () => {\n    const SimpleMDE = require(\"easymde\");\n    const initialOptions = {\n      element: document.getElementById(this.id),\n      initialValue: this.props.value\n    };\n\n    const imageUploadFunction = this.props.options?.imageUploadFunction ? this.imageUploadFunction : undefined\n    const allOptions = Object.assign({}, initialOptions, this.props.options, { imageUploadFunction });\n    this.simpleMde = new SimpleMDE(allOptions);\n  };\n\n  eventWrapper = () => {\n    this.keyChange = true;\n    this.setState({\n      value: this.simpleMde!.value()\n    });\n    this.props.onChange(this.simpleMde!.value());\n  };\n\n  removeEvents = () => {\n    if (this.editorEl && this.editorToolbarEl) {\n      this.editorEl.removeEventListener(\"keyup\", this.eventWrapper);\n      this.editorEl.removeEventListener(\"paste\", this.eventWrapper);\n      this.editorToolbarEl.removeEventListener(\"click\", this.eventWrapper);\n    }\n  };\n\n  addEvents = () => {\n    if (this.elementWrapperRef && this.simpleMde) {\n      this.editorEl = this.elementWrapperRef;\n      this.editorToolbarEl = this.elementWrapperRef.getElementsByClassName(\n        \"editor-toolbar\"\n      )[0];\n\n      this.editorEl.addEventListener(\"keyup\", this.eventWrapper);\n      this.editorEl.addEventListener(\"paste\", this.eventWrapper);\n      this.editorToolbarEl &&\n        this.editorToolbarEl.addEventListener(\"click\", this.eventWrapper);\n\n      this.simpleMde.codemirror.on(\"change\", this.eventWrapper);\n      this.simpleMde.codemirror.on(\"cursorActivity\", this.getCursor);\n\n      const { events } = this.props;\n\n      // Handle custom events\n      events &&\n        Object.entries(events).forEach(([eventName, callback]) => {\n          if (eventName && callback) {\n            this.simpleMde &&\n              this.simpleMde.codemirror.on(\n                eventName as DOMEvent,\n                callback as any\n              );\n          }\n        });\n    }\n  };\n\n  getCursor = () => {\n    // https://codemirror.net/doc/manual.html#api_selection\n    if (this.props.getLineAndCursor) {\n      this.props.getLineAndCursor(\n        this.simpleMde!.codemirror.getDoc().getCursor()\n      );\n    }\n  };\n\n  getMdeInstance = () => {\n    if (this.props.getMdeInstance) {\n      this.props.getMdeInstance(this.simpleMde!);\n    }\n  };\n\n  addExtraKeys = () => {\n    // https://codemirror.net/doc/manual.html#option_extraKeys\n    if (this.props.extraKeys) {\n      this.simpleMde!.codemirror.setOption(\"extraKeys\", Object.assign(\n        {},\n        this.props.extraKeys,\n        this.simpleMde!.codemirror.getOption(\"extraKeys\")\n      ));\n    }\n  };\n\n  render() {\n    const {\n      events,\n      value,\n      options,\n      children,\n      extraKeys,\n      getLineAndCursor,\n      getMdeInstance,\n      label,\n      onChange,\n      id,\n      ...rest\n    } = this.props;\n    return (\n      <div id={`${this.id}-wrapper`} {...rest} ref={this.setElementWrapperRef}>\n        {label && <label htmlFor={this.id}> {label} </label>}\n        <textarea id={this.id} />\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"script"}